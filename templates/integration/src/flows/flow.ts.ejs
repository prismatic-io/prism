import { flow } from "@prismatic-io/spectral";

export const <%= key %> = flow({
  name: "<%= flow.name %>",
  stableKey: "<%= flow.stableKey %>",
  description: "<%= flow.description %>",
  isSynchronous: <%= flow.isSynchronous %>,
  endpointSecurityType: "<%= flow.endpointSecurityType %>",
  onTrigger: {
    component: "<%= trigger.action.component.key %>",
    key: "<%= trigger.action.key %>",
    values: {
      <%- trigger.formattedInputs %>
    },
  },
  onExecution: async (context, params) => {
    const { configVars } = context;

    <%_ steps.forEach((step) => { _%>
      <%_ if (step.loopString) { _%>
    <%- step.loopString %>
      <%_ } else { _%>
    const <%= utils.camelCase(step.name) %> = await context.components.<%= utils.camelCase(step.action.component.key) %>.<%= step.action.key %>({
      <%- step.formattedInputs %>
    });
      <%_ } _%>
    <%_ }) _%>

    // @TODO - what's a reasonable return object?
    return {
      data: [],
    };
  },
});

export default <%= key %>;
